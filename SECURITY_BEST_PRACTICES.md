# Best Practices –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–ª—è SecAudit+

## ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 1. ‚ùå –ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ root

**–ù–ò–ö–û–ì–î–ê –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ root –¥–ª—è –∞—É–¥–∏—Ç–∞!**

–ü–æ—á–µ–º—É —ç—Ç–æ –æ–ø–∞—Å–Ω–æ:
- –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–π —Å–∏—Å—Ç–µ–º–µ
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–ª—É—á–∞–π–Ω–æ–≥–æ –∏–ª–∏ –Ω–∞–º–µ—Ä–µ–Ω–Ω–æ–≥–æ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è
- –ù–∞—Ä—É—à–µ–Ω–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø–∞ –Ω–∞–∏–º–µ–Ω—å—à–∏—Ö –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π (Least Privilege)
- –ù–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∞—É–¥–∏—Ç–∞ –¥–µ–π—Å—Ç–≤–∏–π
- –ù–∞—Ä—É—à–µ–Ω–∏–µ compliance —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π (PCI DSS, HIPAA, ISO 27001)

### 2. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—ã–¥–µ–ª–µ–Ω–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–°–æ–∑–¥–∞–π—Ç–µ `secaudituser` —Å –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º–∏ –ø—Ä–∞–≤–∞–º–∏**

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ –ø—Ä–∞–≤–∞ (—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ)
- –õ–µ–≥–∫–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å –¥–µ–π—Å—Ç–≤–∏—è
- –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ best practices
- Compliance —Å security —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º–∏
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã

**–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è**: [SECURE_AUDIT_USER_SETUP.md](SECURE_AUDIT_USER_SETUP.md)

---

## üîí –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –®–∞–≥ 1: –°–æ–∑–¥–∞–Ω–∏–µ audit –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```bash
# –ù–∞ –∫–∞–∂–¥–æ–π —Ü–µ–ª–µ–≤–æ–π VM
sudo useradd -m -s /bin/bash secaudituser
sudo passwd secaudituser  # –í—Ä–µ–º–µ–Ω–Ω—ã–π –ø–∞—Ä–æ–ª—å
```

### –®–∞–≥ 2: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ sudo –ø—Ä–∞–≤–∞

**–¢–û–õ–¨–ö–û –ø—Ä–∞–≤–∞ –Ω–∞ —á—Ç–µ–Ω–∏–µ!**

```bash
sudo tee /etc/sudoers.d/secaudituser << 'EOF'
# –ß—Ç–µ–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π (–ë–ï–ó –∏–∑–º–µ–Ω–µ–Ω–∏—è!)
secaudituser ALL=(ALL) NOPASSWD: /usr/bin/cat /etc/*
secaudituser ALL=(ALL) NOPASSWD: /usr/bin/systemctl status *
secaudituser ALL=(ALL) NOPASSWD: /bin/ps aux
secaudituser ALL=(ALL) NOPASSWD: /usr/bin/netstat -tulpn
secaudituser ALL=(ALL) NOPASSWD: /usr/sbin/iptables -L

# –ó–ê–ü–†–ï–©–ï–ù–û: systemctl start/stop, apt install, rm, chmod, etc!
EOF

sudo chmod 0440 /etc/sudoers.d/secaudituser
```

### –®–∞–≥ 3: SSH –∫–ª—é—á–∏ (–ë–ï–ó –ø–∞—Ä–æ–ª–µ–π)

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞
ssh-keygen -t ed25519 -f ~/.ssh/secaudit_key -N ""

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ VM
ssh-copy-id -i ~/.ssh/secaudit_key.pub secaudituser@target-host
```

### –®–∞–≥ 4: –ó–∞–ø—Ä–µ—Ç root SSH

```bash
# –ù–∞ –∫–∞–∂–¥–æ–π VM
sudo sed -i 's/^PermitRootLogin yes/PermitRootLogin no/' /etc/ssh/sshd_config
sudo systemctl restart sshd
```

### –®–∞–≥ 5: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–≤–µ–Ω—Ç–æ—Ä–∏

```yaml
groups:
  production:
    vars:
      ssh_user: secaudituser  # –ù–ï root!
      ssh_key: ~/.ssh/secaudit_key
```

---

## üìã –ß–µ–∫–ª–∏—Å—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –∞—É–¥–∏—Ç–∞:

- [ ] –°–æ–∑–¥–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å `secaudituser` (–Ω–µ root)
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ sudo –ø—Ä–∞–≤–∞ (—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ)
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω SSH –¥–æ—Å—Ç—É–ø –ø–æ –∫–ª—é—á—É (–Ω–µ –ø–∞—Ä–æ–ª—å)
- [ ] –ó–∞–ø—Ä–µ—â—ë–Ω root login —á–µ—Ä–µ–∑ SSH
- [ ] –û–±–Ω–æ–≤–ª—ë–Ω –∏–Ω–≤–µ–Ω—Ç–æ—Ä–∏ (ssh_user: secaudituser)
- [ ] –ü—Ä–æ–≤–µ—Ä–µ–Ω –¥–æ—Å—Ç—É–ø: `ssh secaudituser@host "echo test"`

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ä—ã:

- [ ] –í–∫–ª—é—á–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ auditd
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω firewall (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ IP)
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- [ ] –ó–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∞ —Ä–æ—Ç–∞—Ü–∏—è SSH –∫–ª—é—á–µ–π
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–µ–π—Å—Ç–≤–∏–π secaudituser

---

## üö´ –ß—Ç–æ –ù–ò–ö–û–ì–î–ê –Ω–µ –¥–µ–ª–∞—Ç—å

### ‚ùå –û–ø–∞—Å–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏:

1. **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ root**
   ```yaml
   # –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û ‚ùå
   ssh_user: root
   ```

2. **–ù–ï —Ö—Ä–∞–Ω–∏—Ç–µ –ø–∞—Ä–æ–ª–∏ –≤ –∏–Ω–≤–µ–Ω—Ç–æ—Ä–∏**
   ```yaml
   # –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û ‚ùå
   ssh_password: "mypassword123"
   ```

3. **–ù–ï –¥–∞–≤–∞–π—Ç–µ –ø—Ä–∞–≤–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ**
   ```bash
   # –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û ‚ùå
   secaudituser ALL=(ALL) NOPASSWD: /usr/bin/systemctl restart *
   secaudituser ALL=(ALL) NOPASSWD: /usr/bin/apt install *
   ```

4. **–ù–ï –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ SSH –∫–ª—é—á–∏ –≤–µ–∑–¥–µ**
   ```bash
   # –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û ‚ùå
   # –û–¥–∏–Ω –∫–ª—é—á –¥–ª—è production, staging, development
   ```

5. **–ù–ï –æ—Ç–∫–ª—é—á–∞–π—Ç–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
   ```bash
   # –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û ‚ùå
   sudo systemctl stop auditd
   ```

---

## ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### 1. –ü—Ä–∏–Ω—Ü–∏–ø –Ω–∞–∏–º–µ–Ω—å—à–∏—Ö –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π

```bash
# –¢–æ–ª—å–∫–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –∫–æ–º–∞–Ω–¥—ã
secaudituser ALL=(ALL) NOPASSWD: /usr/bin/cat /etc/passwd
# –ù–ï –¥–∞–≤–∞–π—Ç–µ: ALL=(ALL) NOPASSWD: ALL
```

### 2. –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏–π

```yaml
# –†–∞–∑–Ω—ã–µ –∫–ª—é—á–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π
production:
  ssh_key: ~/.ssh/secaudit_prod_key
staging:
  ssh_key: ~/.ssh/secaudit_staging_key
development:
  ssh_key: ~/.ssh/secaudit_dev_key
```

### 3. –†–æ—Ç–∞—Ü–∏—è –∫–ª—é—á–µ–π

```bash
# –ö–∞–∂–¥—ã–µ 90 –¥–Ω–µ–π
ssh-keygen -t ed25519 -f ~/.ssh/secaudit_key_$(date +%Y%m%d)
```

### 4. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

```bash
# –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π
sudo ausearch -k secaudit_commands
```

### 5. Backup –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

```bash
# –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ /etc/sudoers.d/secaudituser
tar -czf secaudit-config-$(date +%Y%m%d).tar.gz \
  /etc/sudoers.d/secaudituser \
  ~/.ssh/authorized_keys
```

---

## üìä –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø–æ–¥—Ö–æ–¥–æ–≤

| –ê—Å–ø–µ–∫—Ç | Root ‚ùå | Secaudituser ‚úÖ |
|--------|---------|-----------------|
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** | –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Ä–∏—Å–∫ | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫ |
| **–ü—Ä–∞–≤–∞** | –ù–µ–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ | –¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ |
| **–ê—É–¥–∏—Ç** | –°–ª–æ–∂–Ω–æ | –õ–µ–≥–∫–æ |
| **Compliance** | –ù–∞—Ä—É—à–µ–Ω–∏–µ | –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ |
| **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ** | –°–ª–æ–∂–Ω–æ–µ | –ü—Ä–æ—Å—Ç–æ–µ |
| **Best Practice** | –ù–ï–¢ | –î–ê |
| **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è** | ‚ùå –ù–ò–ö–û–ì–î–ê | ‚úÖ –í–°–ï–ì–î–ê |

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –¢–µ—Å—Ç 1: –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

```bash
# –î–æ–ª–∂–µ–Ω –±—ã—Ç—å secaudituser, –ù–ï root
cat local_network_inventory.yml | grep ssh_user
# –û–∂–∏–¥–∞–µ—Ç—Å—è: ssh_user: secaudituser
```

### –¢–µ—Å—Ç 2: –ü—Ä–æ–≤–µ—Ä–∫–∞ sudo –ø—Ä–∞–≤

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –ù–ï–¢ –æ–ø–∞—Å–Ω—ã—Ö –ø—Ä–∞–≤
ssh secaudituser@host "sudo systemctl restart sshd"
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: "Sorry, user secaudituser is not allowed..."
```

### –¢–µ—Å—Ç 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ SSH –∫–ª—é—á–µ–π

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–ª—é—á–∏, –Ω–µ –ø–∞—Ä–æ–ª–∏
ssh secaudituser@host "echo test"
# –ù–µ –¥–æ–ª–∂–µ–Ω —Å–ø—Ä–∞—à–∏–≤–∞—Ç—å –ø–∞—Ä–æ–ª—å
```

### –¢–µ—Å—Ç 4: –ü—Ä–æ–≤–µ—Ä–∫–∞ root SSH

```bash
# Root –Ω–µ –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å SSH –¥–æ—Å—Ç—É–ø
ssh root@host
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: "Permission denied"
```

---

## üìö Compliance —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

### PCI DSS

- ‚úÖ –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ 2.1: –ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- ‚úÖ –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ 2.2: –ú–∏–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏
- ‚úÖ –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ 8.1: –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
- ‚úÖ –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ 10.2: –ê—É–¥–∏—Ç –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π

### NIST 800-53

- ‚úÖ AC-6: Least Privilege
- ‚úÖ AC-2: Account Management
- ‚úÖ AU-2: Audit Events
- ‚úÖ IA-2: Identification and Authentication

### CIS Benchmark

- ‚úÖ 5.2.8: Disable root login via SSH
- ‚úÖ 5.2.10: Ensure SSH PermitUserEnvironment is disabled
- ‚úÖ 5.3.3: Ensure password reuse is limited
- ‚úÖ 6.1.10: Ensure no world writable files exist

---

## üéØ –ì–æ—Ç–æ–≤–æ!

–ü–æ—Å–ª–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —ç—Ç–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫:

‚úÖ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–∏—Å–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏  
‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º  
‚úÖ –õ–µ–≥–∫–∏–π –∞—É–¥–∏—Ç –¥–µ–π—Å—Ç–≤–∏–π  
‚úÖ –ü—Ä–æ—Å—Ç–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ  
‚úÖ Best practices –≤—ã–ø–æ–ª–Ω–µ–Ω—ã  

**–¢–µ–ø–µ—Ä—å –º–æ–∂–Ω–æ –±–µ–∑–æ–ø–∞—Å–Ω–æ –ø—Ä–æ–≤–æ–¥–∏—Ç—å agentless –∞—É–¥–∏—Ç!**

```bash
secaudit audit-agentless \
  --inventory local_network_inventory.yml \
  --profile profiles/common/baseline.yml \
  --level paranoid
```

---

## üìñ –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –º–∞—Ç–µ—Ä–∏–∞–ª—ã

- [SECURE_AUDIT_USER_SETUP.md](SECURE_AUDIT_USER_SETUP.md) - –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
- [SSH_SETUP_GUIDE.md](SSH_SETUP_GUIDE.md) - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH
- [docs/AGENTLESS_AUDIT.md](docs/AGENTLESS_AUDIT.md) - Agentless –∞—É–¥–∏—Ç

---

**–ü–æ–º–Ω–∏—Ç–µ: –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø—Ä–µ–≤—ã—à–µ –≤—Å–µ–≥–æ!** üîí
