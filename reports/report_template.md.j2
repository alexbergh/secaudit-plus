{# =========================== SETTINGS =========================== #}
{# –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –æ–¥–Ω–æ—Å—Ç—Ä–æ—á–Ω–æ–≥–æ —Ñ—Ä–∞–≥–º–µ–Ω—Ç–∞ output –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö #}
{% set OUTPUT_TRIM = 200 %}

{# =========================== HELPERS ============================ #}
{% macro norm_status(r) -%}
  {%- set s = (r.status if r.status is defined else r.result|default('')) -%}
  {%- set s = s|string -%}
  {%- if s|lower in ['pass','ok','success'] or s == 'PASS' -%}pass
  {%- elif s|lower in ['fail','failed'] or s == 'FAIL' -%}fail
  {%- elif s|lower in ['error','err'] -%}error
  {%- else -%}unknown
  {%- endif -%}
{%- endmacro %}

{% macro status_badge(s) -%}
  {%- set s = s|lower -%}
  {%- if s == 'pass' -%}‚úÖ –ü—Ä–æ–π–¥–µ–Ω–æ
  {%- elif s == 'fail' -%}‚ùå –ù–µ –ø—Ä–æ–π–¥–µ–Ω–æ
  {%- elif s == 'error' -%}‚ö†Ô∏è –û—à–∏–±–∫–∞
  {%- else -%}‚ùî –ù–µ–æ–ø—Ä–µ–¥–µ–ª—ë–Ω
  {%- endif -%}
{%- endmacro %}

{% macro sev_badge(sev) -%}
  {%- set v = (sev|string|lower) -%}
  {%- if v == 'high' -%}**üî¥ HIGH**
  {%- elif v == 'medium' -%}üü† Medium
  {%- elif v == 'low' -%}üü¢ Low
  {%- else -%}n/a
  {%- endif -%}
{%- endmacro %}

{# –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º tags.fstec –≤ —Å–ø–∏—Å–æ–∫ –∫–æ–¥–æ–≤ –º–µ—Ä ‚Ññ21 #}
{% macro fstec_list(r) -%}
  {%- if r.tags is not defined or not r.tags or ('fstec' not in r.tags) -%}[]{% else -%}
    {%- set raw = r.tags.fstec -%}
    {%- if raw is string -%}[{{ raw }}]{% elif raw is sequence -%}{{ raw }}{% else -%}[]{% endif -%}
  {%- endif -%}
{%- endmacro %}

{# –ß–µ–ª–æ–≤–µ—á–µ—Å–∫–∞—è —Ä–∞—Å—à–∏—Ñ—Ä–æ–≤–∫–∞ –º–µ—Ä ‚Ññ21 (—Ç–æ–ø-–ø–æ–¥–º–Ω–æ–∂–µ—Å—Ç–≤–æ; –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å) #}
{% set FSTEK21 = {
  '–ò–ê–§.1':'–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è/–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤',
  '–ò–ê–§.2':'–ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è/–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —É—Å—Ç—Ä–æ–π—Å—Ç–≤',
  '–ò–ê–§.3':'–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º–∏',
  '–ò–ê–§.4':'–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏',
  '–ò–ê–§.5':'–ó–∞—â–∏—Ç–∞ –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑–∏ –ø—Ä–∏ –≤–≤–æ–¥–µ',
  '–ò–ê–§.6':'–ò–ê –≤–Ω–µ—à–Ω–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π',

  '–£–ü–î.1':'–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—á—ë—Ç–Ω—ã–º–∏ –∑–∞–ø–∏—Å—è–º–∏',
  '–£–ü–î.2':'–†–∞–∑–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–∞',
  '–£–ü–î.3':'–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ñ–æ–ø–æ—Ç–æ–∫–∞–º–∏',
  '–£–ü–î.4':'–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ä–æ–ª–µ–π',
  '–£–ü–î.5':'–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –ø—Ä–∏–≤–∏–ª–µ–≥–∏–∏',
  '–£–ü–î.6':'–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–µ—É—Å–ø–µ—à–Ω—ã—Ö –≤—Ö–æ–¥–æ–≤',
  '–£–ü–î.7':'–ë–∞–Ω–Ω–µ—Ä –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏',
  '–£–ü–î.8':'–û–ø–æ–≤–µ—â–µ–Ω–∏–µ –æ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –≤—Ö–æ–¥–µ',
  '–£–ü–î.9':'–õ–∏–º–∏—Ç –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö —Å–µ—Å—Å–∏–π',
  '–£–ü–î.10':'–¢–∞–π–º–∞—É—Ç —Å–µ—Å—Å–∏–∏',
  '–£–ü–î.11':'–ü—Ä–∞–≤–∞ –¥–æ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏',
  '–£–ü–î.12':'–ê—Ç—Ä–∏–±—É—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏',
  '–£–ü–î.13':'–ó–∞—â–∏—â—ë–Ω–Ω—ã–π —É–¥–∞–ª—ë–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø',
  '–£–ü–î.14':'–ö–æ–Ω—Ç—Ä–æ–ª—å Wi-Fi',
  '–£–ü–î.15':'–ö–æ–Ω—Ç—Ä–æ–ª—å –º–æ–±–∏–ª—å–Ω—ã—Ö –¢–°',
  '–£–ü–î.16':'–í–Ω–µ—à–Ω–∏–µ –ò–°',
  '–£–ü–î.17':'–î–æ–≤–µ—Ä–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞',

  '–û–ü–°.1':'–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–æ–º –ü–û',
  '–û–ü–°.2':'–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤–∫–æ–π –ü–û',
  '–û–ü–°.3':'–¢–æ–ª—å–∫–æ —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω–æ–µ –ü–û',
  '–û–ü–°.4':'–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ñ–∞–π–ª–∞–º–∏',

  '–ó–ù–ò.1':'–£—á—ë—Ç –Ω–æ—Å–∏—Ç–µ–ª–µ–π –ü–î–Ω',
  '–ó–ù–ò.2':'–î–æ—Å—Ç—É–ø –∫ –Ω–æ—Å–∏—Ç–µ–ª—è–º –ü–î–Ω',
  '–ó–ù–ò.3':'–ö–æ–Ω—Ç—Ä–æ–ª—å –ø–µ—Ä–µ–º–µ—â–µ–Ω–∏—è –Ω–æ—Å–∏—Ç–µ–ª–µ–π',
  '–ó–ù–ò.4':'–ò—Å–∫–ª—é—á–∏—Ç—å –ù–°–î –∫ –ü–î–Ω –Ω–∞ –Ω–æ—Å–∏—Ç–µ–ª—è—Ö',
  '–ó–ù–ò.5':'–ö–æ–Ω—Ç—Ä–æ–ª—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤ –≤–≤–æ–¥–∞/–≤—ã–≤–æ–¥–∞',
  '–ó–ù–ò.6':'–ö–æ–Ω—Ç—Ä–æ–ª—å –≤–≤–æ–¥–∞/–≤—ã–≤–æ–¥–∞',
  '–ó–ù–ò.7':'–ö–æ–Ω—Ç—Ä–æ–ª—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –Ω–æ—Å–∏—Ç–µ–ª–µ–π',
  '–ó–ù–ò.8':'–£–Ω–∏—á—Ç–æ–∂–µ–Ω–∏–µ/–æ–±–µ–∑–ª–∏—á–∏–≤–∞–Ω–∏–µ –ü–î–Ω',

  '–†–°–ë.1':'–°–æ–±—ã—Ç–∏—è –∏ —Å—Ä–æ–∫–∏ —Ö—Ä–∞–Ω–µ–Ω–∏—è',
  '–†–°–ë.2':'–°–æ—Å—Ç–∞–≤ –∑–∞–ø–∏—Å–µ–π',
  '–†–°–ë.3':'–°–±–æ—Ä/–∑–∞–ø–∏—Å—å/—Ö—Ä–∞–Ω–µ–Ω–∏–µ',
  '–†–°–ë.4':'–°–±–æ–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏',
  '–†–°–ë.5':'–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∂—É—Ä–Ω–∞–ª–æ–≤',
  '–†–°–ë.6':'–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏',
  '–†–°–ë.7':'–ó–∞—â–∏—Ç–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–æ–±—ã—Ç–∏—è—Ö',

  '–ê–í–ó.1':'–ê–Ω—Ç–∏–≤–∏—Ä—É—Å–Ω–∞—è –∑–∞—â–∏—Ç–∞',
  '–ê–í–ó.2':'–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–≥–Ω–∞—Ç—É—Ä',

  '–°–û–í.1':'–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –≤—Ç–æ—Ä–∂–µ–Ω–∏–π',
  '–°–û–í.2':'–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∏–ª',

  '–ê–ù–ó.1':'–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç—è–º–∏',
  '–ê–ù–ó.2':'–ö–æ–Ω—Ç—Ä–æ–ª—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π',
  '–ê–ù–ó.3':'–ö–æ–Ω—Ç—Ä–æ–ª—å –°–ó–ò/–Ω–∞—Å—Ç—Ä–æ–µ–∫',
  '–ê–ù–ó.4':'–ö–æ–Ω—Ç—Ä–æ–ª—å —Å–æ—Å—Ç–∞–≤–∞ –¢–°/–ü–û/–°–ó–ò',
  '–ê–ù–ó.5':'–ö–æ–Ω—Ç—Ä–æ–ª—å –ø–∞—Ä–æ–ª–µ–π/–∞–∫–∫–∞—É–Ω—Ç–æ–≤/—Ä–æ–ª–µ–π',

  '–û–¶–õ.1':'–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –ü–û',
  '–û–¶–õ.2':'–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –ü–î–Ω –≤ –ë–î',
  '–û–¶–õ.3':'–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ü–û',
  '–û–¶–õ.4':'–ó–∞—â–∏—Ç–∞ –æ—Ç —Å–ø–∞–º–∞',
  '–û–¶–õ.5':'–ö–æ–Ω—Ç—Ä–æ–ª—å –∏—Å—Ö–æ–¥—è—â–µ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞',
  '–û–¶–õ.6':'–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –ø—Ä–∞–≤ –≤–≤–æ–¥–∞',
  '–û–¶–õ.7':'–¢–æ—á–Ω–æ—Å—Ç—å –≤–≤–æ–¥–∏–º—ã—Ö –¥–∞–Ω–Ω—ã—Ö',
  '–û–¶–õ.8':'–ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–∞—Ö',

  '–û–î–¢.1':'–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤—ã–µ –¢–°',
  '–û–î–¢.2':'–†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ',
  '–û–î–¢.3':'–ö–æ–Ω—Ç—Ä–æ–ª—å –±–µ–∑–æ—Ç–∫–∞–∑–Ω–æ—Å—Ç–∏',
  '–û–î–¢.4':'–ë—ç–∫–∞–ø –ü–î–Ω',
  '–û–î–¢.5':'–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ü–î–Ω',

  '–ó–°–í.1':'–ò–ê–§ –≤ –í–ò',
  '–ó–°–í.2':'–î–æ—Å—Ç—É–ø –≤ –í–ò',
  '–ó–°–í.3':'–ñ—É—Ä–Ω–∞–ª—ã –≤ –í–ò',
  '–ó–°–í.4':'–ü–æ—Ç–æ–∫–∏/–ø–µ—Ä–∏–º–µ—Ç—Ä –í–ò',
  '–ó–°–í.5':'–î–æ–≤–µ—Ä–µ–Ω–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –≤ –í–ò',
  '–ó–°–í.6':'–ú–∏–≥—Ä–∞—Ü–∏—è –í–ú/–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤',
  '–ó–°–í.7':'–¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –í–ò/–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π',
  '–ó–°–í.8':'–†–µ–∑–µ—Ä–≤ –≤ –í–ò',
  '–ó–°–í.9':'–ê–Ω—Ç–∏–≤–∏—Ä—É—Å –≤ –í–ò',
  '–ó–°–í.10':'–°–µ–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –í–ò',

  '–ó–¢–°.1':'–£—Ç–µ—á–∫–∏ –ø–æ –¢–ö–£',
  '–ó–¢–°.2':'–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º–∞—è –∑–æ–Ω–∞',
  '–ó–¢–°.3':'–§–∏–∑–∏—á–µ—Å–∫–∏–π –¥–æ—Å—Ç—É–ø',
  '–ó–¢–°.4':'–†–∞–∑–º–µ—â–µ–Ω–∏–µ –¥–∏—Å–ø–ª–µ–µ–≤',
  '–ó–¢–°.5':'–í–Ω–µ—à–Ω–∏–µ –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏—è',

  '–ó–ò–°.1':'–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π',
  '–ó–ò–°.2':'–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã',
  '–ó–ò–°.3':'–ó–∞—â–∏—Ç–∞ –ü–î–Ω –ø—Ä–∏ –ø–µ—Ä–µ–¥–∞—á–µ',
  '–ó–ò–°.4':'–î–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –∫–∞–Ω–∞–ª—ã/–º–∞—Ä—à—Ä—É—Ç—ã',
  '–ó–ò–°.5':'–ó–∞–ø—Ä–µ—Ç —É–¥–∞–ª—ë–Ω–Ω–æ–π –ø–µ—Ä–∏—Ñ–µ—Ä–∏–∏',
  '–ó–ò–°.6':'–ê—Ç—Ä–∏–±—É—Ç—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –æ–±–º–µ–Ω–µ',
  '–ó–ò–°.7':'–ú–æ–±–∏–ª—å–Ω—ã–π –∫–æ–¥',
  '–ó–ò–°.8':'–ü–µ—Ä–µ–¥–∞—á–∞ —Ä–µ—á–∏',
  '–ó–ò–°.9':'–í–∏–¥–µ–æ–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è',
  '–ó–ò–°.10':'–ü—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏–µ –∏–º—ë–Ω/–∞–¥—Ä–µ—Å–æ–≤',
  '–ó–ò–°.11':'–ü–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π',
  '–ó–ò–°.12':'–ù–µ–æ—Ç—Ä–µ–∫–∞–µ–º–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–∫–∏',
  '–ó–ò–°.13':'–ù–µ–æ—Ç—Ä–µ–∫–∞–µ–º–æ—Å—Ç—å –ø–æ–ª—É—á–µ–Ω–∏—è',
  '–ó–ò–°.14':'–¢–µ—Ä–º–∏–Ω–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø',
  '–ó–ò–°.15':'–ó–∞—â–∏—Ç–∞ –∞—Ä—Ö–∏–≤–æ–≤/–Ω–∞—Å—Ç—Ä–æ–µ–∫',
  '–ó–ò–°.16':'–°–∫—Ä—ã—Ç—ã–µ –∫–∞–Ω–∞–ª—ã',
  '–ó–ò–°.17':'–°–µ–≥–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ò–°',
  '–ó–ò–°.18':'–ß—Ç–µ–Ω–∏–µ-—Ç–æ–ª—å–∫–æ –Ω–æ—Å–∏—Ç–µ–ª–∏ + —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å',
  '–ó–ò–°.19':'–ò–∑–æ–ª—è—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–æ–≤',
  '–ó–ò–°.20':'–ó–∞—â–∏—Ç–∞ –±–µ—Å–ø—Ä–æ–≤–æ–¥–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π'
} %}

{# –£—Ç–∏–ª–∏—Ç–∞: –∫–æ—Ä–æ—Ç–∫–∞—è —Å—Ç—Ä–æ–∫–∞ output #}
{% macro short_output(text) -%}
  {{ (text|default('')|replace('\n',' ')|trim|truncate(OUTPUT_TRIM, True)) }}
{%- endmacro %}

{# =========================== HEADER ============================ #}
# –û—Ç—á—ë—Ç SecAudit++

**–ü—Ä–æ—Ñ–∏–ª—å:** {{ (profile.profile_name if profile is defined and profile.profile_name is defined else profile_name|default('‚Äî')) }}  
**–û–ø–∏—Å–∞–Ω–∏–µ:** {{ (profile.description if profile is defined and profile.description is defined else profile_description|default('‚Äî')) }}  
**–î–∞—Ç–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è:** {{ (now.strftime("%Y-%m-%d %H:%M:%S") if now is defined else timestamp|default('‚Äî')) }}

---

{# ========================= KPI / SUMMARY ======================== #}
{% set _statuses = results | map('norm_status') if false else [] %}
{% set total = results|length %}
{% set passed = results|selectattr('status','equalto','pass')|list|length %}
{% if passed == 0 %}
  {# –í—Ö–æ–¥ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å 'result' –≤–º–µ—Å—Ç–æ 'status' ‚Äî –ø–æ–¥—Å—Ç—Ä–∞—Ö—É–µ–º—Å—è: #}
  {% set passed = results|selectattr('result','equalto','PASS')|list|length %}
{% endif %}
{% set failed = results|selectattr('status','equalto','fail')|list|length %}
{% if failed == 0 %}
  {% set failed = results|selectattr('result','equalto','FAIL')|list|length %}
{% endif %}
{% set errors = results|selectattr('status','equalto','error')|list|length %}
{% set unknown = total - passed - failed - errors %}
{% set compliance = (100.0 * passed / total) | round(1) if total > 0 else 0 %}

**–ò—Ç–æ–≥–∏:** –≤—Å–µ–≥–æ **{{ total }}**, ‚úÖ –ø—Ä–æ–π–¥–µ–Ω–æ **{{ passed }}**, ‚ùå –Ω–µ –ø—Ä–æ–π–¥–µ–Ω–æ **{{ failed }}**, ‚ö†Ô∏è –æ—à–∏–±–æ–∫ **{{ errors }}**, ‚ùî –ø—Ä–æ—á–µ–µ **{{ unknown }}**.  
**–ò–Ω–¥–µ–∫—Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è:** **{{ compliance }}%**

---

{# =================== –ì–†–£–ü–ü–ò–†–û–í–ö–ê –ü–û –ú–û–î–£–õ–Ø–ú ==================== #}
{% for module, checks in results | groupby('module') %}
## –ú–æ–¥—É–ª—å: {{ module | capitalize }} ({{ checks | length }} –ø—Ä–æ–≤–µ—Ä–æ–∫)

| ‚Ññ | –ü—Ä–æ–≤–µ—Ä–∫–∞ | Severity | FSTEK ‚Ññ21 | Assert | –†–µ–∑—É–ª—å—Ç–∞—Ç | –û–∂–∏–¥–∞–Ω–∏–µ | –§–∞–∫—Ç (—Ñ—Ä–∞–≥–º–µ–Ω—Ç) |
|---|---|---|---|---|---|---|---|
{% for check in checks %}
  {% set s = norm_status(check) %}
  {% set fl = fstec_list(check) %}
| {{ loop.index }} | {{ check.name }} | {{ sev_badge(check.severity) }} | 
  {%- if fl|length > 0 -%} {{ fl|join(', ') }} {%- else -%} ‚Äî {%- endif -%} |
  `{{ check.assert_type|default('exact') }}` | {{ status_badge(s) }} |
  `{{ check.expect|default('') }}` |
  `{{ short_output(check.output) }}` |
{% endfor %}

{% endfor %}

---

{# ============== –°–í–û–î–ö–ê –ü–û –ú–ï–†–ê–ú –§–°–¢–≠–ö ‚Ññ21 (–µ—Å–ª–∏ –µ—Å—Ç—å) ============== #}
{% set seen = {} %}
{% for r in results %}
  {% for m in fstec_list(r) %}
    {% set _ = seen.update({m: (seen.get(m, []) + [r])}) %}
  {% endfor %}
{% endfor %}

{% if seen %}
## –°–≤–æ–¥–∫–∞ –ø–æ –º–µ—Ä–∞–º –§–°–¢–≠–ö ‚Ññ21
| –ú–µ—Ä–∞ | –û–ø–∏—Å–∞–Ω–∏–µ | –í—Å–µ–≥–æ | ‚úÖ Pass | ‚ùå Fail | ‚ö†Ô∏è Error |
|---|---|---:|---:|---:|---:|
{% for m, rs in seen|dictsort %}
  {% set p = rs | selectattr('status','equalto','pass')  | list | length %}
  {% if p == 0 %}{% set p = rs | selectattr('result','equalto','PASS') | list | length %}{% endif %}
  {% set f = rs | selectattr('status','equalto','fail')  | list | length %}
  {% if f == 0 %}{% set f = rs | selectattr('result','equalto','FAIL') | list | length %}{% endif %}
  {% set e = rs | selectattr('status','equalto','error') | list | length %}
| **{{ m }}** | {{ FSTEK21.get(m, '‚Äî') }} | {{ rs|length }} | {{ p }} | {{ f }} | {{ e }} |
{% endfor %}
{% else %}
_–¢–µ–≥–∏ –§–°–¢–≠–ö ‚Ññ21 –≤ –ø—Ä–æ–≤–µ—Ä–∫–∞—Ö –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç._
{% endif %}

---

{# ============== –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ù–ï–°–û–û–¢–í–ï–¢–°–¢–í–ò–Ø (HIGH) ============== #}
{% set highs = results
  | selectattr('severity','equalto','high')
  | selectattr('status','equalto','fail') | list %}
{% if highs|length == 0 %}
  {# fallback –Ω–∞ –ø–æ–ª–µ result #}
  {% set highs = results
    | selectattr('severity','equalto','high')
    | selectattr('result','equalto','FAIL') | list %}
{% endif %}

## –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è (High)
{% if highs %}
{% for r in highs %}
- **{{ r.name }}** (`{{ r.id }}`)
  - –ú–æ–¥—É–ª—å: `{{ r.module }}`
  - –ú–µ—Ä—ã ‚Ññ21: 
    {%- set fl = fstec_list(r) -%}
    {%- if fl|length > 0 -%} {{ fl|join(', ') }} ‚Äî {{ fl | map('string') | map('trim') | map('upper') | list | map('attr', FSTEK21) | list | reject('equalto', None) | list | join('; ') }}
    {%- else -%} ‚Äî {%- endif -%}
  - –û–∂–∏–¥–∞–Ω–∏–µ: `{{ r.expect|default('') }}`
  - Assert: `{{ r.assert_type|default('exact') }}`
  - –ö–æ–º–∞–Ω–¥–∞:
    ```bash
    {{ r.command }}
    ```
  - –§–∞–∫—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–≤–æ–¥:
    ```
    {{ r.output|default('')|trim }}
    ```
{% endfor %}
{% else %}
_–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –Ω–µ—Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–π –Ω–µ –≤—ã—è–≤–ª–µ–Ω–æ._
{% endif %}

---

{# ======================== –ö–û–ù–¢–ï–ö–°–¢ –•–û–°–¢–ê ======================== #}
## –°–∏—Å—Ç–µ–º–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
- –•–æ—Å—Ç: **{{ host.hostname|default('‚Äî') }}**
- –û–°: **{{ host.os|default('‚Äî') }}**
- –Ø–¥—Ä–æ: **{{ host.kernel|default('‚Äî') }}**
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞: **{{ host.arch|default('‚Äî') }}**
- –í—Ä–µ–º—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: **{{ (now.strftime("%Y-%m-%d %H:%M:%S") if now is defined else timestamp|default('‚Äî')) }}**

{# ============================= END ============================= #}
