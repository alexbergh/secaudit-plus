# Дорожная карта и статус покрытия

Документ объединяет текущий статус покрытых областей и планы развития SecAudit+. Используется как контрольный список при
добавлении новых проверок и приоритезации задач на ближайшие спринты.

## 1. Текущее покрытие проверок

### 1.1. Аутентификация и управление доступом
- Блоки `base_shadow_no_empty_passwords` и `base_system_accounts_shells` контролируют отсутствие пустых паролей и блокировку системных учётных записей.
- Политики `sudo` требуют `requiretty`, журналирование (`log_output`, `logfile`, `mail_badpass`) и исключают `NOPASSWD` за счёт allowlist.
- PAM-профиль фиксирует `pam_faillock` с параметрами из переменных профиля и политику сложности `pam_pwquality` (длина, difok, кредиты классов символов, retry).

### 1.2. Журналирование и синхронизация времени
- Контролируются службы `chronyd`/`ntpd`, надёжность источников времени, наличие `makestep` и минимального числа серверов.
- Набор проверок `systemd-journald` обеспечивает persistent-хранилище, лимиты размера, компрессию и пересылку в syslog.
- `auditd` покрыт правилами на критичные файлы/действия и проверками `auditd.conf` (реакции на переполнение, минимальный размер журнала).

### 1.3. Файловая система и права
- Требования к монтированию `/tmp`, `/var/tmp`, `/home`, `/dev/shm`, `/run/shm` и `/var/log` с флагами `nodev`, `nosuid`, `noexec` подтверждены регрессионными тестами.
- Проверяется deny-list для SUID/SGID и world-writable директорий без sticky-бита, а также запрет user-mountable записей в `/etc/fstab` с allowlist исключений.
- Контроль целостности загрузочного процесса и конфигурации ядра включает secure boot, параметры ядра и запрещённые модули.

### 1.4. Сеть, сервисы и виртуализация
- Категория `network` охватывает iptables/nftables, управление IPv6, опрос открытых портов, контроль вспомогательных служб (CUPS, Avahi, bluetooth, SSH-agent).
- Проверки `fail2ban` валидируют активность службы и наличие хотя бы одного jail.
- Для контейнеров и виртуализации предусмотрены проверки Docker (прослушивание TCP, привилегированные контейнеры, CapAdd, использование `:latest`) и Libvirt (логирование auditd, ограничения на сокеты управления).

### 1.5. Репозитории и пакеты
- Для APT и RPM проверяется включённая верификация подписей (`Signed-By`, `gpgcheck`) и отсутствие доверенных репозиториев без проверки подписи.
- Фиксированы минимальные версии ключевых пакетов (ядро, sudo, openssh) и контроль неизвестных репозиториев.

### 1.6. Автоматические тесты и схема профиля
- `tests/test_profiles.py` валидирует уникальность идентификаторов, корректность шаблонов и ОС-специфичные переопределения.
- Расширенная JSON-схема ограничивает формат `vars`: допускаются только верхний регистр/цифры в ключах, структуры `defaults`, `levels`, `files` и `optional_files`, что подтверждено тестами валидатора.

### 1.7. Расширяемость профилей и исключения
- Реализовано наследование allowlist/denylist с приоритетами, удалением записей и валидацией конфликтов.
- CLI принимает явные уровни, что позволяет управлять каскадированием исключений и повторно использовать шаблоны проверок.

### 1.8. Отчётность, аналитика и интеграции
- HTML/Markdown отчёты содержат раздел «Remediation» с шагами исправления и группировкой по FSTEK/тегам.
- Генераторы SARIF и JUnit подключены к `secaudit audit`, отчёты сохраняются рядом с HTML/Markdown артефактами и пригодны для публикации в CI/CD.
- Экспорт Prometheus (`metrics.prom`) и Elastic NDJSON (`elastic.ndjson`) выполняется автоматически, обеспечивая интеграцию с системами мониторинга.
- Команда `secaudit compare` и модуль `report_diff` позволяют сравнивать JSON-отчёты и выявлять регрессии/улучшения между сборками.
- Готовые Grafana dashboards (6 панелей) и Prometheus alerting rules (5 правил) для визуализации и оповещений.
- GitHub Actions workflows для автоматической публикации Docker образов в GHCR с SBOM и Trivy сканированием.

### 1.9. Ролевые профили
- Профиль `roles/db.yml` контролирует статус PostgreSQL/MySQL, шифрование/SSL, журналирование, trust-записи в `pg_hba.conf`, владельцев каталогов и системного пользователя БД.
- Профиль `roles/kiosk.yml` покрывает GDM-autologin, политику Firefox Kiosk, блокировку TTY, маскирование Ctrl+Alt+Del и заморозку обновлений.

### 1.10. DevOps и контейнеризация
- Helm chart для Kubernetes с поддержкой Deployment, CronJob, PVC, ServiceAccount и Ingress.
- Multi-stage Dockerfile для оптимизированной сборки образов.
- docker-compose.yml с сервисами для production, development и testing.
- Автоматическая публикация в GitHub Container Registry с multi-platform builds (amd64, arm64).
- ServiceMonitor для Prometheus Operator и интеграция с Grafana.

### 1.11. Качество кода и тестирование
- Comprehensive error handling с детальными сообщениями об ошибках.
- Файловое логирование с timestamp и уровнями детализации (DEBUG, INFO, WARN, ERROR, CRITICAL).
- 11 integration tests для end-to-end проверки workflow.
- Comprehensive docstrings в Google Style с примерами использования.
- CI/CD workflows: CodeQL, Semgrep, Bandit, Safety, Gitleaks, TruffleHog.
- Pre-commit hooks с 10+ инструментами проверки качества.
- Makefile с 20+ командами для автоматизации разработки.

## 2. Фокус ближайших итераций

### 2.1. Горизонт «Сейчас» (1–2 спринта)
- **Покрытие профилей.** Добавить профиль для рабочих станций (GUI, Bluetooth/USB, браузеры) и укрепить контейнерный раздел базового профиля проверками Podman/containerd и ограничениями на rootless-контейнеры.
- **Движок и UX.** Ввести ограничение на параллелизм/приоритет команд, отчёт о потреблении ресурсов в CLI и управление тайм-аутами на уровне профиля.
- **Увеличение test coverage.** Довести покрытие тестами до 80%+ с добавлением тестов для критичных модулей.

### 2.2. Горизонт «Скоро» (квартал)
- **Ролевые и отраслевые профили.** Разработать профили для рабочих станций разработчиков, bastion-хостов и средств защиты информации, переиспользуя allowlist/denylist.
- **Контейнеры и виртуализация.** Расширить проверку Libvirt/KVM (пулы хранения, ограничение live-migration) и добавить контроль Kubernetes/Openshift (RBAC, PSP/OPA-политики).
- **Отчётность и анализ.** Реализовать baseline-политику для `secaudit compare` (файлы допусков, fail-on-regression) и добавление исторических трендов в Prometheus/Elastic экспорт.

### 2.3. Горизонт «Дальше» (полугодие)
- **Автоматическое исправление.** Связать результаты аудита с Ansible-плейбуками и разработать CLI `secaudit remediate-plan` для формирования чек-листа по `FAIL`.
- **Генерация профилей.** Поддержать шаблоны YAML с параметризацией и генерацией проверок из описаний (policy-as-code).
- **Расширение платформ.** Исследовать создание базовых профилей для Windows/macOS и поддержку удалённого сбора фактов через SSH-агентов.

## 3. Шаги контроля качества
- Запуск `pytest`, `secaudit audit` и `secaudit compare` на примерах для подтверждения поведения и фиксации выходных данных/диффов.
- Валидация профилей через `secaudit validate` перед публикацией, корректировка YAML при нарушениях схемы и приоритетов allowlist/denylist.
- Документирование изменений в README и `docs/`, поддержание актуальности профилей, примеров CI и include-файлов переменных.

Документ пересматривается по мере реализации задач. При добавлении новых проверок или модулей обновляйте соответствующие разделы и ссылки.
